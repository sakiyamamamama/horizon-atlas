<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><link rel="preload" href="/horizon-atlas/_next/static/css/43d771fade83ccf9.css" as="style"/><link rel="stylesheet" href="/horizon-atlas/_next/static/css/43d771fade83ccf9.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/horizon-atlas/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/horizon-atlas/_next/static/chunks/webpack-d6b9fb8b967c62fc.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/framework-a6b3d2fb26bce5d1.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/main-17de9138735c079b.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/pages/_app-4ff5b0e6267ccde7.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/019d026b-098b74cb779c3b0d.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/fea29d9f-dfee5f8797568931.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/41155975-57e00c569646619d.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/68c0a17d-506338dcc33b54ec.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/ebc70433-f2ab0dbd5b778f3d.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/117b9d7f-b10fdd21b2f0939d.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/257e8032-4f94a427f00c1f50.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/cb355538-193e0b5c5d7db318.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/860-6124e3a5f0abff91.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/396-e21666584d7c3a12.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/855-40a8b69cc32cc053.js" defer=""></script><script src="/horizon-atlas/_next/static/chunks/pages/posts/curriculums/%5BcurriculumId%5D/%5BpageId%5D-df2c329afb78fda7.js" defer=""></script><script src="/horizon-atlas/_next/static/ALgaCejQZrABwXgBmpKFY/_buildManifest.js" defer=""></script><script src="/horizon-atlas/_next/static/ALgaCejQZrABwXgBmpKFY/_ssgManifest.js" defer=""></script></head><body class="antialiased"><div id="__next"><div class="fixed inset-0 flex justify-center items-center bg-black bg-opacity-50"><div class="bg-white p-6 rounded-lg shadow-lg w-96"><h2 class="text-xl font-bold mb-4">ログインが必要です</h2><button class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">OK</button></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"metadata":{"title":"データベース基礎","curriculumId":"1ada501e-f337-81e8-b251-df0f38a0cb23","category":"後期","visibility":["基礎班","発展班"],"tags":["基礎班","データベース","Python"],"is_basic_curriculum":true,"id":"127"},"mdBlocks":[{"blockId":"1ada501e-f337-8148-8102-c572f2478d26","type":"paragraph","parent":"今回は、データベースにおける「マイグレーション」について説明します。","children":[]},{"blockId":"1ada501e-f337-81e9-ab74-dbeb33243e4c","type":"heading_2","parent":"## マイグレーションとは？","children":[]},{"blockId":"1ada501e-f337-81ff-82c6-c35dca9a3e48","type":"divider","parent":"---","children":[]},{"blockId":"1ada501e-f337-8131-a592-f0353757b1e5","type":"heading_3","parent":"### 概要","children":[]},{"blockId":"1ada501e-f337-81f5-b9ff-e0ea9a0673ec","type":"paragraph","parent":"データベースにおける「マイグレーション（migration）」とは、データベースのスキーマ（構造）を変更する処理を指します。例えば、新しいテーブルの追加、既存のテーブルへのカラムの追加や削除、データ型の変更など。要するに、既存のデータベースの構造を後から変更したい時に、いつでも変更できるような仕組みがマイグレーションです。","children":[]},{"blockId":"1ada501e-f337-8199-8e5b-d20d2aeeb66b","type":"heading_3","parent":"### マイグレーションの流れ","children":[]},{"blockId":"1ada501e-f337-817a-8c08-fc6233214b20","type":"numbered_list_item","parent":"1. **スキーマ（構造）の変更**: 開発者が新しい機能を実装するためにデータベースのスキーマを変更します（例えば、新しいカラムを追加するなど）。","children":[]},{"blockId":"1ada501e-f337-81c9-b319-ce01b1c246e7","type":"numbered_list_item","parent":"2. **変更内容を記録するファイルの作成**: 変更内容を記録するファイル（マイグレーションファイル）を作成します。このファイルには、データベースの変更方法が記述されています。","children":[]},{"blockId":"1ada501e-f337-811f-9019-f4cd4fc9587f","type":"numbered_list_item","parent":"3. **マイグレーションの適用**: マイグレーションツールを使用して、変更内容を実際のデータベースに適用します。これにより、データベースが新しいスキーマ（構造）に更新されます。","children":[]},{"blockId":"1ada501e-f337-81d1-8f91-cee6636df277","type":"heading_3","parent":"### マイグレーションのメリット","children":[]},{"blockId":"1ada501e-f337-811a-9808-c3c015ccf7b7","type":"bulleted_list_item","parent":"- データベースの構造をいつでも簡単に変更できる","children":[]},{"blockId":"1ada501e-f337-810b-918c-d792295685f9","type":"bulleted_list_item","parent":"- データベースの中のデータを引き継ぎつつ構造を変更できる","children":[]},{"blockId":"1ada501e-f337-81e0-9d45-f122205cb362","type":"bulleted_list_item","parent":"- データベースの更新履歴が残る","children":[]},{"blockId":"1ada501e-f337-81c5-a234-d6afe6d6c016","type":"heading_2","parent":"## マイグレーションの仕組みを作ろう","children":[]},{"blockId":"1ada501e-f337-81a0-b459-fb4b4b305ebe","type":"divider","parent":"---","children":[]},{"blockId":"1ada501e-f337-8104-beef-ea4ce666ca27","type":"paragraph","parent":"さて、ここから実際にPythonとsqlite3を用いてマイグレーションをいつでも実行できる仕組みを作ってみましょう。","children":[]},{"blockId":"1ada501e-f337-81ea-bdf4-f0ac8f3294c9","type":"heading_3","parent":"### フォルダ構造","children":[]},{"blockId":"1ada501e-f337-8199-b360-cad5afb242e0","type":"paragraph","parent":"まず、今回マイグレーションの仕組みを作成するために以下のフォルダ構造を用意してください。","children":[]},{"blockId":"1ada501e-f337-81a9-a284-ef911800bcc5","type":"callout","parent":"\u003e フォルダ構造  \n\u003e ![%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-12-01_15.33.01.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/4faae8b3-4c31-46a7-898b-465eb6114fd9/4000a4a9-3194-45d5-99ec-ab7404cea9fe/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-12-01_15.33.01.png?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Content-Sha256=UNSIGNED-PAYLOAD\u0026X-Amz-Credential=ASIAZI2LB466WMF5Q2BV%2F20250315%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250315T011956Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjELH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCfrAPE3O6kVigHHfW5Yo3jyfLvZ4VRBXNXC5rou3HduQIgQQ%2FPGzs8UaAYNByIg8c%2BvC26hKCSy6Yfee44IcQwXbQqiAQI%2Bv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDJt2owe7g5n7M7qB6CrcA%2FBuXoo5WdkIv6lLTT%2BkUb3hun242dIPcazZoWR7l9lujikvYNS2EC%2FtpfOHKfrhuDDAzSatgZQQXGDK%2BLYLUB%2B72MYKvDs9aLg528pc4CI2Y1WCohLFPJA4Ti2aI0mP4L8Ta5OMy4qIsmuUHg5pOxt%2FiSGszsFYNi1E9w%2FnPvpR4TdJNzlhu%2BY7kybKw9K723rIaTOCoOZSLQ2gOz7wMeiCZzQi2kD3cD5nOpVmxMp8MuNWlaNTETai3f0pdsCmWMwHacM%2BzLkUalFoezy9K6XLYJ%2BVoK97Pl%2BpJULad4Q06Z1WBcqDK9%2F9wlLci09tbJtR8UKRd357gdcMoK8Mu9xScEUVFzO%2Faw0hhu6s0Ms4D0QD9GyVjGJuy50gb0Ur79nTy%2BlP78MQ%2BfrBzWjAnWsUe%2BEF0IRRS7v%2FhRRXV%2F3h4ChgRjpTAgLsvNdEcKTCjgU3XboYZ%2BMr2i1GMMRLbZUyoKZuj5jqnw%2Ffk7zdZC36Buq1xygdvupvaNbEoA9W6v4I7BeGQd0cXUuk4TN0Efu33eTrgFpU24KYv3sLNuCTYQ8RVxgsVxNwv4rpXpPPhva42KiCFGmDQg18bdraHF5XS2g9RXrfIBbCCSRrYPKFQNsurJIU15DXaCz9MIKq074GOqUBdmrzg8lQDDvBwC6cZZluBxEA%2FzOO35QIRquLtoLs%2BgRjnLjkLBcpgcOg7hgcYkskxPJX1hme3l8XkCwzenc6jjIBHYBShhcdAfIaeR8kVCKfDqw1WGcpQa4KeNlArfLDAe1Yjvsy3caksMMvUMKxf0yuqQdQ4sIXS9AvA4dvjqVBqnpXbCWkLkox3jwPFN1hmgEf8UuJPAGlaz81O9%2FMFdxuG9rx\u0026X-Amz-Signature=83067d8952aa4364f8846736b2d4a954317b0893777f615dcdd2f50d1627e871\u0026X-Amz-SignedHeaders=host\u0026x-id=GetObject)","children":[{"blockId":"1ada501e-f337-812d-8d5e-defd0c0657b0","type":"image","parent":"![%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-12-01_15.33.01.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/4faae8b3-4c31-46a7-898b-465eb6114fd9/4000a4a9-3194-45d5-99ec-ab7404cea9fe/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-12-01_15.33.01.png?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Content-Sha256=UNSIGNED-PAYLOAD\u0026X-Amz-Credential=ASIAZI2LB466XK6Q7KR5%2F20250315%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250315T011955Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjELH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIEiy7TBbDEM4O6u1MZRiCl0cc0z7EOrmkuMEtKMGRba1AiA4kwMXKDNa%2BT0hagzn2%2F%2FkeSc5cU0uGF0Mh7HcWyG53SqIBAj6%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIMZV7XfmZEsPUrRqTkKtwDs6SiYhk25f5NSq0HuQJDTHEI7upQbyosee%2F5AwIyiJTOi3hpZR43WanUaJgAD8L0q9GqTypMsD1Wbgn8HmzZGSxgDBp7e%2Fr5cuS5h6pQuOCQ0FABvjVE%2BgL8BzMRSG68oEXKbg2sFLnvBa0ekxStyrgLyx5acIDrUwx3brk%2BCVIYAOObK1ONYv1sNSDK8K77aZ%2Fv8rgipMs8SO6DN4Xt79om6jwUmau7OwtTAehZCx3TmUUPP%2B5jIyJdOt1BL%2BoOROlW8Pyd6MtQQ4etc55vEp4NBS3ZtkJLjjMp3Q8fjnmYuOJ34n2BhSValAIXar0kdjBfFqB202IgbKL8rO8SUAAlyLRXVdBRS%2BDcYqKIQB3bc4f%2BWfOQE76EuEGBNKpD3h7rjfQVMz1fq8KIZ9fVmMt7h4%2BPHp3ow5x8MmcLHMZmSyHzFQLCTa02VmlzY7UXELtXsyUOzNTN%2BmzpUhcVJvuSFKEsT7GJ5re8verAIYUbEicrGyxRAMk%2BGpSPTL%2Fq5y7fMDpAt%2FMGUbw3l535deiRobu99SRIH3C3GaISbyZlvGEZb5qb06%2FVkbUZs8hjbcTdgSGtS0K85k9cxXx%2Fd86vBaLEcIzAngVsZWKqLqxyhGlGK5JEvHpmtW0w2KnTvgY6pgEbsbsh3vQg%2F2%2Bj%2F87bhFRTIevsDMTwu2%2Fmy39Kn4%2FJhw4fjV723CGrHGXCgcB0NFNUiHKyNteULWKrS%2BJ1KqJHKGEXYsjTNS4s7dVuGbARSdjOLjeWlQwtWvA5qJzRtqlaHsoUwbBd2Ox7mHBUKFlGXaJsTVRfcpS5Ip1TEWJjDcxox76gDYfY06iyGYGYt6ot2dSB%2ByzuaAvKMX%2F2g8vecAv31TjJ\u0026X-Amz-Signature=08b131042f317da482709dac99f7820524fddd563e2a4e05065aa4b4d70c4459\u0026X-Amz-SignedHeaders=host\u0026x-id=GetObject)","children":[]}]},{"blockId":"1ada501e-f337-816a-bd59-ef0e0d6450f5","type":"bulleted_list_item","parent":"- `migration_test/` （今回のルート[根っこの]フォルダ）","children":[{"blockId":"1ada501e-f337-8116-b2a9-c01f2fdfad87","type":"bulleted_list_item","parent":"- `apply_migrations.py` （マイグレーションを適用するための実行用ファイル）","children":[]},{"blockId":"1ada501e-f337-81b9-a45e-e458a0655773","type":"bulleted_list_item","parent":"- `migrations/`　（マイグレーションファイルを格納するフォルダ）","children":[]},{"blockId":"1ada501e-f337-8102-b9ca-ecbfa97f7ac2","type":"bulleted_list_item","parent":"- `create_migrations_table.py`　（マイグレーションテーブルを作成するスクリプト）","children":[]},{"blockId":"1ada501e-f337-8134-ac7e-de1aa2475758","type":"bulleted_list_item","parent":"- `TEST.db`　（データベースファイル）","children":[]}]},{"blockId":"1ada501e-f337-81ed-9c74-c72520f27318","type":"heading_3","parent":"### データベースとマイグレーションの設定","children":[]},{"blockId":"1ada501e-f337-81d6-baad-d1d1944d819f","type":"paragraph","parent":"まず、適用済みのマイグレーションを保存するために、データベースに`migrations`テーブルを作成します。","children":[]},{"blockId":"1ada501e-f337-8159-8382-ef5bb2ea7c80","type":"callout","parent":"\u003e `migrations`テーブル  \n\u003e | カラム名  | id                                | migration_name | applied_at                          |  \n\u003e | ----- | --------------------------------- | -------------- | ----------------------------------- |  \n\u003e | 属性    | INTEGER PRIMARY KEY AUTOINCREMENT | TEXT UNIQUE    | TIMESTAMP DEFAULT CURRENT_TIMESTAMP |  \n\u003e | 保存する値 | 一意の値                              | マイグレーションの名前    | いつ適用されたか                            |","children":[{"blockId":"1ada501e-f337-8165-ab77-de78a85692fa","type":"table","parent":"| カラム名  | id                                | migration_name | applied_at                          |\n| ----- | --------------------------------- | -------------- | ----------------------------------- |\n| 属性    | INTEGER PRIMARY KEY AUTOINCREMENT | TEXT UNIQUE    | TIMESTAMP DEFAULT CURRENT_TIMESTAMP |\n| 保存する値 | 一意の値                              | マイグレーションの名前    | いつ適用されたか                            |","children":[{"blockId":"1ada501e-f337-81ad-9c96-d4a7c4aa1abc","type":"table_row","parent":"","children":[]},{"blockId":"1ada501e-f337-81eb-a62c-f357d7a5e0b0","type":"table_row","parent":"","children":[]},{"blockId":"1ada501e-f337-8150-848d-e65f2460df66","type":"table_row","parent":"","children":[]}]}]},{"blockId":"1ada501e-f337-8125-bafc-d0ac9f7b6d3a","type":"paragraph","parent":"`create_migrations_table.py` に、以下のコードを記述してください。","children":[]},{"blockId":"1ada501e-f337-8173-8027-f53c55d91428","type":"callout","parent":"\u003e `create_migrations_table.py`  \n\u003e ```python  \n\u003e import sqlite3  \n\u003e   \n\u003e def create_migrations_table(dbname):  \n\u003e \tconn = sqlite3.connect(dbname)  \n\u003e \tcur = conn.cursor()  \n\u003e \tcur.execute('''  \n\u003e \t\t\tCREATE TABLE IF NOT EXISTS migrations (  \n\u003e \t\t\tid INTEGER PRIMARY KEY AUTOINCREMENT,  \n\u003e \t\t\tmigration_name TEXT UNIQUE,  \n\u003e \t\t\tapplied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP)  \n\u003e \t''')  \n\u003e \tconn.commit()  \n\u003e \t  \n\u003e \tcur.close()  \n\u003e \tconn.close()  \n\u003e ```","children":[{"blockId":"1ada501e-f337-81eb-a859-fbd0148a2f1c","type":"code","parent":"```python\nimport sqlite3\n\ndef create_migrations_table(dbname):\n\tconn = sqlite3.connect(dbname)\n\tcur = conn.cursor()\n\tcur.execute('''\n\t\t\tCREATE TABLE IF NOT EXISTS migrations (\n\t\t\tid INTEGER PRIMARY KEY AUTOINCREMENT,\n\t\t\tmigration_name TEXT UNIQUE,\n\t\t\tapplied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP)\n\t''')\n\tconn.commit()\n\t\n\tcur.close()\n\tconn.close()\n```","children":[]}]},{"blockId":"1ada501e-f337-812f-b22c-ef0cabd44d26","type":"paragraph","parent":"テーブルを作成するSQL文が、`CREATE TABLE IF NOT EXISTS テーブル名`となっています。`IF NOT EXISTS`がない場合、既にテーブルが作成されていれば、`table already exists`というエラーが発生します。既に存在するテーブルを作成しようとするとエラーが発生するわけです。","children":[]},{"blockId":"1ada501e-f337-8134-9970-d827b977af0c","type":"paragraph","parent":"したがって、`IF NOT EXISTS`があることで、テーブルが作成済みでない場合のみテーブルを作成する処理が行われ、エラーを回避できます。","children":[]},{"blockId":"1ada501e-f337-8143-9189-dc2cffef3703","type":"heading_3","parent":"### **マイグレーションファイルの作成**","children":[]},{"blockId":"1ada501e-f337-81d5-bb23-ca8631828777","type":"paragraph","parent":"最初の`migrations`テーブルの作成以外で、データベースの構造を変更したい場合は、全てマイグレーションファイルに記述することが望ましいです。（なぜなら、そうすると全ての変更履歴が残るからです）","children":[]},{"blockId":"1ada501e-f337-81f2-bbe0-fab06708f1a5","type":"paragraph","parent":"マイグレーションファイルを `migrations` フォルダ内に配置します。","children":[]},{"blockId":"1ada501e-f337-81e9-947a-f565f23e3605","type":"paragraph","parent":"**ファイルの名前**","children":[]},{"blockId":"1ada501e-f337-81a3-9104-d6ce39f26d05","type":"paragraph","parent":"マイグレーションファイルの名前は一貫性を持たせることが望まれます。\n次のような名前にすることが一般的です：","children":[]},{"blockId":"1ada501e-f337-813e-a1b4-f1bc7f9b16c1","type":"bulleted_list_item","parent":"- `連番_変更内容`","children":[]},{"blockId":"1ada501e-f337-81fd-bb22-e0135a880357","type":"paragraph","parent":"例えば、最初のスキーマ（構造）を規定する`001_initial_schema.py`や、emailカラムを追加する`002_add_email_column.py`や、userテーブルを追加する`003_add_user_table.py` など。","children":[]},{"blockId":"1ada501e-f337-8172-ad39-ebc9b4c240e7","type":"paragraph","parent":"ファイルの名前にこのような規則を持たせることで、どの変更をどの順番で行ったのかがいつでも確認できるようになります。","children":[]},{"blockId":"1ada501e-f337-81c5-961a-fbcf05a293af","type":"paragraph","parent":"**ファイルの内容**","children":[]},{"blockId":"1ada501e-f337-812e-a6ef-c3e2a3a1b5c9","type":"paragraph","parent":"マイグレーションファイルの内容は、データベースのスキーマ（構造）を変更するSQL文を実行する処理となります。","children":[]},{"blockId":"1ada501e-f337-81cc-ab7d-d12814626bd3","type":"paragraph","parent":"例えば、新しいテーブルの作成、カラムの追加、カラムの削除、など。","children":[]},{"blockId":"1ada501e-f337-81ed-81ab-ef442d09e991","type":"paragraph","parent":"**ファイルの作成**","children":[]},{"blockId":"1ada501e-f337-8133-9033-dd16799dd6e6","type":"paragraph","parent":"今回は、`migrations` フォルダ内に`001_initial_schema.py`と`002_add_email_column.py`を作ってみましょう。","children":[]},{"blockId":"1ada501e-f337-8160-8e53-efb291c31b3e","type":"callout","parent":"\u003e フォルダ構造  \n\u003e ![%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-12-01_15.33.35.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/4faae8b3-4c31-46a7-898b-465eb6114fd9/1874a4c5-dcca-4a9e-8886-d23eff0489dd/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-12-01_15.33.35.png?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Content-Sha256=UNSIGNED-PAYLOAD\u0026X-Amz-Credential=ASIAZI2LB466SJQRMUV5%2F20250315%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250315T012002Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjELH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIGnToxLv3Quar8pJB3%2F3jH8kf32d8hDGlq2ZPIjXP%2BWIAiB3tX7zYMD6u5dWu2P2IoQtC%2BuFuq29KA%2B71zZE1JGmSiqIBAj6%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIM%2BifKKW9PZEL%2B1UR1KtwDdU%2BBdZMGpf5VqdLVpH25cjeI7CBg6zapXr3t6etuLm%2FISAeUlyXNG7%2FtB%2BQXQXViDU4BZXnB6cRoq3g%2FRVnAYs%2BGKKPqAd4OIZ6AjJy7OevwcdeF6DG%2BwehoRntXham%2F7Tsog%2BK%2Fk9R4UbmgAQnVwg%2FXmDJKkeHwvVXWAtq2M91Ekr4iRb6G6U012UhaIzjla0mgJNhXneeD4rCMkk8n0q2z6mXDDJfPYX9GbcDG528vsicUudad7f%2B16rZu1eAjAaIX5ITzPZfxHgcQ%2FzDzEJj6LThK2LAQ78fSUzzqIicM0c0C2avjHOZ8i35Dp3DK0t2bYA0lCppa4tpuCY2w2NtXlUxodPpMOvKoDxkpNrD4ZjDLUC0pauPHdB01XMbDxrs3YU%2B90kC8VQCjgRCcibVkabImWYt5VNSohpRxIKzvOOlcPw5CVhZKead0N1nk9NQNCP55kdLL3ATGyzjsjX9uPYPzGWWfYxewHFt8E%2FmqK4VI3gaQYIG4ziddgxiVdHJ1DhMm1SA76ChQ6dGnjk20357%2BAnpCYypstugO9u68VOfiG8%2BR3aD3ic37yTziIm%2B2e%2FNgjxKzvhJciV9k1EtsVKrr%2Fbd5CuXGIXvlVOdfWeGQhZT%2BgS380G4w76nTvgY6pgEXi4rh4XGOaz7vCqKRCFXiuX%2BrdPpIsPd%2FqGHn1SNhtE1qBmWYqCEeVFzvMoH83JeJV98XNbziDn0D1wKk5zJc9RoJ%2Fh11criiKtXui%2FcCuWG0kYIG%2BMNwnGhezaybECwd9j6N2%2BsA7we2xdPBek3LIsQC0SNRZiMS31JINar9ZVCDV0uzQ%2FVCrcTmmCdEwWcmcdYnu02Q1Y1j6tEdrxN2nR%2BBjuXb\u0026X-Amz-Signature=2449c5a9cd48744de0f32f29faeaeaba6755d17ca2864f5e696b413bb0174fff\u0026X-Amz-SignedHeaders=host\u0026x-id=GetObject)","children":[{"blockId":"1ada501e-f337-8129-8673-dd8c138eeae4","type":"image","parent":"![%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-12-01_15.33.35.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/4faae8b3-4c31-46a7-898b-465eb6114fd9/1874a4c5-dcca-4a9e-8886-d23eff0489dd/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-12-01_15.33.35.png?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Content-Sha256=UNSIGNED-PAYLOAD\u0026X-Amz-Credential=ASIAZI2LB466ZAHXYI2B%2F20250315%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250315T012002Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjELH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIA0k93%2BNxqL05ccH%2BYmAPRNftPoP19wa2zi7sU4b6bXLAiBqpWcZpgJE0oj3%2Bar802rRVtWeEmlLEOFskV1rLNJgQCqIBAj6%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIM4OkVKzcMX4pFM3mLKtwDKRQjnySndKVoGkjDXllOnO3P2XahRpQ0TlG3nZ3iiEbGouw6NVOvXIBYDj1rOgdrvWx8q1tkeXMigx1t4zTw9buVceVtwZNRuzBX%2FhzDM6dFiUdnSYjKNdXhli8ycK9XhJPcQ4YzYTPNrB4ieS7FeM4Pz%2FqRa%2Fp8zGJgaFM84rpFissZEHmyrFp7Wx6Y0n7Fqa03ogAefekk1CYK1F20%2BVaVborkCrZvNoyKZGlvXxRDJ5CWw9vzLtbbftDBfNp61eBkl%2Fh5M%2BUG84Xi3r7%2F8K5cfJhK1MAdZ5C1jcRLXfb6W1FQNtvcrMUEFz20ajkWu7esRrSlaVzmWPo8omaSXBl4ORa7VQnsUcuZ5iIXWXCl9m8YsEZBQbKylxlfvflUfBFeeBR7abgexxRsvwG7F89pIPIZ8xd808NAyJbiPC2UH07ExFA23GBh1qwIky6%2BXW8iWZEIF4Am3bfpubPfg%2BqbXDfeKuSgQQyiEGmAGu5kOYTOUj27PlWRtc5yaDRhHwBiodHuazxUVJg9m2pyV%2BicQQy0AUTwS8mNQoxrd2hkqhJofc48hJevdD1NpIWT8GhYhTH9lrH0%2Fb36NjTlTnA9BaoZBx%2FOa7BKPJjZRXms%2F8F5%2Bh0WblqTdGQwtqnTvgY6pgFWc7I4a8uqTKu1xrepyK1kSeIA8ZJL7l%2BxltL4%2B1AtGLu82sPTindHbqTC1PVqZ%2BdcYP%2Bqjd7JEk6coZRlqqFCzE4ThxUMC4LYPginEMIZfMjdhEOIJ8zUFzwNup3maXAYMtsNHWEqjCxSIpAegfZOJdZmVLDHgkplDLgkckb2oafiy4PRqVM1nhy6H5%2BVY3QAYkOHLd%2Bk5pXY2%2B7a1mx4jfCMIkHD\u0026X-Amz-Signature=1b1f9d031763a38a3df129e95371c98eb75d54bc8337f3a99463f38eb0e42054\u0026X-Amz-SignedHeaders=host\u0026x-id=GetObject)","children":[]}]},{"blockId":"1ada501e-f337-81f1-8305-f073e41d0ee2","type":"paragraph","parent":"以下に二つのファイルの内容を載せます。","children":[]},{"blockId":"1ada501e-f337-812a-88fb-d3c3c2837c8c","type":"callout","parent":"\u003e `001_initial_schema.py`  \n\u003e ```python  \n\u003e import sqlite3  \n\u003e   \n\u003e dbname = 'TEST.db'  \n\u003e   \n\u003e def apply_migration():  \n\u003e   conn = sqlite3.connect(dbname)  \n\u003e   cur = conn.cursor()  \n\u003e   cur.execute('''  \n\u003e     CREATE TABLE IF NOT EXISTS users (  \n\u003e       id INTEGER PRIMARY KEY AUTOINCREMENT,  \n\u003e       name TEXT NOT NULL)  \n\u003e   ''')  \n\u003e   conn.commit()  \n\u003e     \n\u003e   cur.close()  \n\u003e   conn.close()  \n\u003e ```","children":[{"blockId":"1ada501e-f337-8149-9c80-d3a7a53653ec","type":"code","parent":"```python\nimport sqlite3\n\ndbname = 'TEST.db'\n\ndef apply_migration():\n  conn = sqlite3.connect(dbname)\n  cur = conn.cursor()\n  cur.execute('''\n    CREATE TABLE IF NOT EXISTS users (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      name TEXT NOT NULL)\n  ''')\n  conn.commit()\n  \n  cur.close()\n  conn.close()\n```","children":[]}]},{"blockId":"1ada501e-f337-81b0-841c-fcc73300bd23","type":"callout","parent":"\u003e `002_add_email_column.py`  \n\u003e ```python  \n\u003e import sqlite3  \n\u003e   \n\u003e dbname = 'TEST.db'  \n\u003e   \n\u003e def apply_migration():  \n\u003e     conn = sqlite3.connect(dbname)  \n\u003e     cur = conn.cursor()  \n\u003e     cur.execute('''  \n\u003e         ALTER TABLE users ADD COLUMN email TEXT  \n\u003e     ''')  \n\u003e     conn.commit()  \n\u003e       \n\u003e     cur.close()  \n\u003e     conn.close()  \n\u003e ```","children":[{"blockId":"1ada501e-f337-8195-b379-cbff7f528db2","type":"code","parent":"```python\nimport sqlite3\n\ndbname = 'TEST.db'\n\ndef apply_migration():\n    conn = sqlite3.connect(dbname)\n    cur = conn.cursor()\n    cur.execute('''\n        ALTER TABLE users ADD COLUMN email TEXT\n    ''')\n    conn.commit()\n    \n    cur.close()\n    conn.close()\n```","children":[]}]},{"blockId":"1ada501e-f337-8150-8b69-eafdd8664b27","type":"paragraph","parent":"`001_initial_schema.py`では、usersテーブルを新たに作成する処理を記述しています。`002_add_email_column.py`では、usersテーブルにemailカラムを追加する処理を記述しています。","children":[]},{"blockId":"1ada501e-f337-810d-9df0-c3a89ddeee67","type":"paragraph","parent":"上記で、今回のマイグレーションファイルができました。","children":[]},{"blockId":"1ada501e-f337-81d3-b66a-d8ed480a0a26","type":"heading_3","parent":"### **マイグレーションの適用**","children":[]},{"blockId":"1ada501e-f337-81f8-91aa-cc84f9c63321","type":"paragraph","parent":"すべてのマイグレーションファイルを適用するロジックを作成します。","children":[]},{"blockId":"1ada501e-f337-8132-9e86-cc0041df8b47","type":"paragraph","parent":"定義する関数は二つです。`get_applied_migrations関数`と`apply_migrations関数`です。","children":[]},{"blockId":"1ada501e-f337-81d3-aef7-d63510a09c5d","type":"paragraph","parent":"`get_applied_migrations関数`：`migrations` テーブルを使って、すでに適用されたマイグレーションを取得する。","children":[]},{"blockId":"1ada501e-f337-81d7-8446-f2e3a966e0ba","type":"paragraph","parent":"`apply_migrations関数`：`get_applied_migrations関数`を使って適用済みのマイグレーションをスキップし、適用されていないマイグレーションファイルを順番に読み込んで実行する。最後に、適用したマイグレーションを`migrations`テーブルに記録する。","children":[]},{"blockId":"1ada501e-f337-81d8-96b4-dceba99709f1","type":"callout","parent":"\u003e `apply_migrations.py`  \n\u003e ```python  \n\u003e import os  \n\u003e import sqlite3  \n\u003e from create_migrations_table import create_migrations_table  \n\u003e   \n\u003e # マイグレーションスクリプトのディレクトリ  \n\u003e migration_dir = 'migrations/'  \n\u003e dbname = 'TEST.db'  \n\u003e   \n\u003e def get_applied_migrations():  \n\u003e     conn = sqlite3.connect(dbname)  \n\u003e     cur = conn.cursor()  \n\u003e     cur.execute('SELECT migration_name FROM migrations')  \n\u003e     applied_migrations = [row[0] for row in cur.fetchall()]  \n\u003e     conn.close()  \n\u003e     return applied_migrations  \n\u003e   \n\u003e def apply_migrations():  \n\u003e     create_migrations_table(dbname)  \n\u003e     # 適用済みのマイグレーションを取得  \n\u003e     applied_migrations = get_applied_migrations()  \n\u003e   \n\u003e     # マイグレーションファイルを読み込む  \n\u003e     migration_files = os.listdir(migration_dir)  \n\u003e     print(migration_files)  \n\u003e   \n\u003e     conn = sqlite3.connect(dbname)  \n\u003e     cur = conn.cursor()  \n\u003e   \n\u003e     for migration_file in migration_files:  \n\u003e         if migration_file not in applied_migrations:  \n\u003e             module_name = migration_file[:-3]  # 拡張子「.py」を削除  \n\u003e             # マイグレーションスクリプトをインポートして実行  \n\u003e             migration_module = __import__(f'migrations.{module_name}', fromlist=['apply_migration'])  \n\u003e             migration_module.apply_migration()  \n\u003e   \n\u003e             # マイグレーションが適用されたことを記録  \n\u003e             cur.execute('INSERT INTO migrations (migration_name) VALUES (?)', (migration_file,))  \n\u003e             conn.commit()  \n\u003e     cur.close()  \n\u003e     conn.close()  \n\u003e   \n\u003e apply_migrations()  \n\u003e ```","children":[{"blockId":"1ada501e-f337-819b-b30e-f80a15405ced","type":"code","parent":"```python\nimport os\nimport sqlite3\nfrom create_migrations_table import create_migrations_table\n\n# マイグレーションスクリプトのディレクトリ\nmigration_dir = 'migrations/'\ndbname = 'TEST.db'\n\ndef get_applied_migrations():\n    conn = sqlite3.connect(dbname)\n    cur = conn.cursor()\n    cur.execute('SELECT migration_name FROM migrations')\n    applied_migrations = [row[0] for row in cur.fetchall()]\n    conn.close()\n    return applied_migrations\n\ndef apply_migrations():\n    create_migrations_table(dbname)\n    # 適用済みのマイグレーションを取得\n    applied_migrations = get_applied_migrations()\n\n    # マイグレーションファイルを読み込む\n    migration_files = os.listdir(migration_dir)\n    print(migration_files)\n\n    conn = sqlite3.connect(dbname)\n    cur = conn.cursor()\n\n    for migration_file in migration_files:\n        if migration_file not in applied_migrations:\n            module_name = migration_file[:-3]  # 拡張子「.py」を削除\n            # マイグレーションスクリプトをインポートして実行\n            migration_module = __import__(f'migrations.{module_name}', fromlist=['apply_migration'])\n            migration_module.apply_migration()\n\n            # マイグレーションが適用されたことを記録\n            cur.execute('INSERT INTO migrations (migration_name) VALUES (?)', (migration_file,))\n            conn.commit()\n    cur.close()\n    conn.close()\n\napply_migrations()\n```","children":[]}]},{"blockId":"1ada501e-f337-81b9-a9fb-d43c542141e7","type":"paragraph","parent":"`apply_migrations.py`の内容を記述したら実行してみてください。","children":[]},{"blockId":"1ada501e-f337-815b-9ed3-f6acd20fd9c3","type":"paragraph","parent":"`TEST.db`の中に以下のように、`migrations`テーブルにマイグレーションが記録されていて、`users`テーブルが作成されていれば成功です。","children":[]},{"blockId":"1ada501e-f337-81ce-a8aa-d3bc029d625e","type":"callout","parent":"\u003e `TEST.db`  \n\u003e `migrations`テーブル  \n\u003e   \n\u003e ![%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-12-01_18.38.01.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/4faae8b3-4c31-46a7-898b-465eb6114fd9/d23815f3-5ea7-442e-a0ec-3718e9fed970/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-12-01_18.38.01.png?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Content-Sha256=UNSIGNED-PAYLOAD\u0026X-Amz-Credential=ASIAZI2LB466S5UDYVUV%2F20250315%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250315T012004Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjELH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQC5KtLDwYfXoMj5jmmng6Dn9eXJuFSgvIc9OBdrVBogBwIhAINWQphGWvd619mpj%2BIGFmwDGL29A0gvqv4cKi6WbmgNKogECPr%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1Igxj9QqSM%2BsVeSiE%2FZQq3AP%2FwT13Xfi3bCEDD8YQaFYSSjemThVQBqnLEZqYW17qVRwm5NsfTJ4SYuYv%2F1rCKNagDXmBejpODM1rXUU5lfwl56xBdn%2BBZLIi5W6zCUBNk2qNgjOyxbbmyIVBLJaogzRYYwpRDznZpMw%2FUHnEJE1SJ%2F2dOPKpkZ0Uh8SrvrCCu%2BipvTOMYZSLL4gqshnvCiiP3HuA18UXRGeyaxEvGNtD7rNMTWbtHj7i4abCVIwnM6IqDS8inpGAdalEVm6z0nxUHDtwKCwwyfib21Kq3vOfYsErY6NhLU1sq4X0R7K4lmDbVW%2BXBXfT8JKDlXYwbt56zTKRbCu91ZtpLkJ%2F2hM%2FnlRSTfBORjkoHEalLSX3zzX4HXI4eFsp8b4CYVPRNKY5CwSRxZ3b6uA6S1lP4%2Bxni7c5dl14fqwK94VF59Xd%2BRMQeoJb0ulBNPPkbfYHnnUQ17eUsSs%2BfC0t%2FgH7i8uKdEBSoQAOaGbqFh5MaUNcboPxjoRP7uJ%2FbvXz2hvoXdC3xfR99L8WMMiCCJH6SuihhyprT1TMbV04H4xBDGon4dIZXLBE4BpKQ%2Fk6UHVG7OEuW2k%2FcoUVhi7%2Be5hASoQfuLPJ88WFu7KE9j55GqcZHOusPWVdxPybxfj1XjDTqdO%2BBjqkAZ0WXqMM5J0oVqbJhu0iC2FvpIZd%2BPBNB9ByBZQQ8bAEwQf61ANKg3EFfpMU3nouo1C2OoF9wFDZeLh8UkHe539%2BT%2FSj9YGwpu8z1F%2FDsAsKIcYFdBUXeBJFB0Z5S83zyowsv429OwTInJO1RhOz%2FZ9RmBNr%2BpyO%2BUl9qCsGpMQd3dvUCrVDFOUarfTm3uiVr5hWYp3eKGbgjhy2sz5%2FWAlonAb3\u0026X-Amz-Signature=66b0960c3f42e6220dca1fd7de209ef8ac77424618966828660f947b1ca1fffb\u0026X-Amz-SignedHeaders=host\u0026x-id=GetObject)  \n\u003e   \n\u003e `users`テーブル  \n\u003e   \n\u003e ![%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-12-02_9.54.40.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/4faae8b3-4c31-46a7-898b-465eb6114fd9/c77f6e2c-853b-45b4-b122-090b6d142813/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-12-02_9.54.40.png?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Content-Sha256=UNSIGNED-PAYLOAD\u0026X-Amz-Credential=ASIAZI2LB466S5UDYVUV%2F20250315%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250315T012004Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjELH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQC5KtLDwYfXoMj5jmmng6Dn9eXJuFSgvIc9OBdrVBogBwIhAINWQphGWvd619mpj%2BIGFmwDGL29A0gvqv4cKi6WbmgNKogECPr%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1Igxj9QqSM%2BsVeSiE%2FZQq3AP%2FwT13Xfi3bCEDD8YQaFYSSjemThVQBqnLEZqYW17qVRwm5NsfTJ4SYuYv%2F1rCKNagDXmBejpODM1rXUU5lfwl56xBdn%2BBZLIi5W6zCUBNk2qNgjOyxbbmyIVBLJaogzRYYwpRDznZpMw%2FUHnEJE1SJ%2F2dOPKpkZ0Uh8SrvrCCu%2BipvTOMYZSLL4gqshnvCiiP3HuA18UXRGeyaxEvGNtD7rNMTWbtHj7i4abCVIwnM6IqDS8inpGAdalEVm6z0nxUHDtwKCwwyfib21Kq3vOfYsErY6NhLU1sq4X0R7K4lmDbVW%2BXBXfT8JKDlXYwbt56zTKRbCu91ZtpLkJ%2F2hM%2FnlRSTfBORjkoHEalLSX3zzX4HXI4eFsp8b4CYVPRNKY5CwSRxZ3b6uA6S1lP4%2Bxni7c5dl14fqwK94VF59Xd%2BRMQeoJb0ulBNPPkbfYHnnUQ17eUsSs%2BfC0t%2FgH7i8uKdEBSoQAOaGbqFh5MaUNcboPxjoRP7uJ%2FbvXz2hvoXdC3xfR99L8WMMiCCJH6SuihhyprT1TMbV04H4xBDGon4dIZXLBE4BpKQ%2Fk6UHVG7OEuW2k%2FcoUVhi7%2Be5hASoQfuLPJ88WFu7KE9j55GqcZHOusPWVdxPybxfj1XjDTqdO%2BBjqkAZ0WXqMM5J0oVqbJhu0iC2FvpIZd%2BPBNB9ByBZQQ8bAEwQf61ANKg3EFfpMU3nouo1C2OoF9wFDZeLh8UkHe539%2BT%2FSj9YGwpu8z1F%2FDsAsKIcYFdBUXeBJFB0Z5S83zyowsv429OwTInJO1RhOz%2FZ9RmBNr%2BpyO%2BUl9qCsGpMQd3dvUCrVDFOUarfTm3uiVr5hWYp3eKGbgjhy2sz5%2FWAlonAb3\u0026X-Amz-Signature=f64d810fefeecb0773161b16ada8eea9d1a446e03c1ddcef7b6b7f645cc6cabd\u0026X-Amz-SignedHeaders=host\u0026x-id=GetObject)","children":[{"blockId":"1ada501e-f337-810c-830b-e04bac57f0f6","type":"paragraph","parent":"`migrations`テーブル","children":[]},{"blockId":"1ada501e-f337-81a7-b0d4-cd326b986483","type":"image","parent":"![%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-12-01_18.38.01.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/4faae8b3-4c31-46a7-898b-465eb6114fd9/d23815f3-5ea7-442e-a0ec-3718e9fed970/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-12-01_18.38.01.png?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Content-Sha256=UNSIGNED-PAYLOAD\u0026X-Amz-Credential=ASIAZI2LB4666JXSRNM2%2F20250315%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250315T012004Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjELH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQClfqzb0kStLFdpnB4RKWTyM9IjPHJbuJlP9ZYdZ%2BjMFQIgDCxO%2BK2Op6apMOsoqMl%2Fko4aIYjt0sviRInsEIIKaS4qiAQI%2Bv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDN5cbJYPgj%2FAK1Qu2CrcA7C6ndhYSOkOrtDWOf3n92i%2BXrMk%2FjZTtEZcPW%2BD0x0vq6ME9IGxsTDANxTddB0FoyhmuBRdj63HE4%2F7K3j56%2BbCJVmOdvwwQV%2B1Hro2dHfeQnZAgfNHwjSs5l1Tb4jL08HFORt2NGG%2BaZGuKEZesR3NmclCK9%2BInhqciOOvNDZwOUegmh0CjTRsS1p%2FBEdylLDShSFjrc22jXGxHBpB4Efot7W46mSxPr6jHFAl9tHnFl5jvHrY%2BVuIzNfuF5mHcK4Fdal8nEVZ4JNs47NL5MvVOIEKCfTgYYWKfagw%2FUjlw%2BFNXzDI9ni0YbXVBZf0bp7zb4H5GA%2FZJRQdT4klDlzu48Oirl%2BB%2Flv%2FHra3NTHM%2FQRl7lI65U1IypNgzUZaM%2BSVVchBFJhY%2FPyyizevSQ7Y9xzmQL7kLryMy8d6TkoZ3Xacj%2F4cHzlIFL%2BVRDjfWzaXs8cDFRbMsaO60y142PYhYbvYKEqxO5uEGuHoRAzy%2BieqGwCcN1XkgWDicZmbQp1bmULzvC77XQgbhAE3nGX41D5%2FyZOs7iiJ5CTtfaXJ3WbUZ79UjF8gP8Db%2FHd9Whaa4whvS3P88fxxEbjhGOJ2FIU4xnd7RV1GoNu2GBAZYJTae%2FzyyLubZ5ltMIOq074GOqUB0EIUVvlOVwUd20ctR204X0Zv7g6nLuwtZjrVu1anqiJ9mRUp0DKOlZCvNFH0EZItdA19g20EdVCafyEBvYxh16QadYGMci0htsAbXwxDXmm%2B%2BppVpPBQTlR7HORtxNBXH2R2GvpFhIqxUPCqieJcTjmMqpiHYRgk9aIXGT7nO99SK%2F7Rz%2BpruSVNtCQ2ExrdUN4tqjYZG7KVujsgP56ZSSpAVdXi\u0026X-Amz-Signature=454088852cc4bbcfde715ed41734ab3ac37709f701e011e4ef7649f06687115a\u0026X-Amz-SignedHeaders=host\u0026x-id=GetObject)","children":[]},{"blockId":"1ada501e-f337-8191-b267-d4cbbc46c318","type":"paragraph","parent":"`users`テーブル","children":[]},{"blockId":"1ada501e-f337-8132-a6c8-e26276aed4f7","type":"image","parent":"![%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-12-02_9.54.40.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/4faae8b3-4c31-46a7-898b-465eb6114fd9/c77f6e2c-853b-45b4-b122-090b6d142813/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88_2024-12-02_9.54.40.png?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Content-Sha256=UNSIGNED-PAYLOAD\u0026X-Amz-Credential=ASIAZI2LB4666JXSRNM2%2F20250315%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250315T012004Z\u0026X-Amz-Expires=3600\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjELH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQClfqzb0kStLFdpnB4RKWTyM9IjPHJbuJlP9ZYdZ%2BjMFQIgDCxO%2BK2Op6apMOsoqMl%2Fko4aIYjt0sviRInsEIIKaS4qiAQI%2Bv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDN5cbJYPgj%2FAK1Qu2CrcA7C6ndhYSOkOrtDWOf3n92i%2BXrMk%2FjZTtEZcPW%2BD0x0vq6ME9IGxsTDANxTddB0FoyhmuBRdj63HE4%2F7K3j56%2BbCJVmOdvwwQV%2B1Hro2dHfeQnZAgfNHwjSs5l1Tb4jL08HFORt2NGG%2BaZGuKEZesR3NmclCK9%2BInhqciOOvNDZwOUegmh0CjTRsS1p%2FBEdylLDShSFjrc22jXGxHBpB4Efot7W46mSxPr6jHFAl9tHnFl5jvHrY%2BVuIzNfuF5mHcK4Fdal8nEVZ4JNs47NL5MvVOIEKCfTgYYWKfagw%2FUjlw%2BFNXzDI9ni0YbXVBZf0bp7zb4H5GA%2FZJRQdT4klDlzu48Oirl%2BB%2Flv%2FHra3NTHM%2FQRl7lI65U1IypNgzUZaM%2BSVVchBFJhY%2FPyyizevSQ7Y9xzmQL7kLryMy8d6TkoZ3Xacj%2F4cHzlIFL%2BVRDjfWzaXs8cDFRbMsaO60y142PYhYbvYKEqxO5uEGuHoRAzy%2BieqGwCcN1XkgWDicZmbQp1bmULzvC77XQgbhAE3nGX41D5%2FyZOs7iiJ5CTtfaXJ3WbUZ79UjF8gP8Db%2FHd9Whaa4whvS3P88fxxEbjhGOJ2FIU4xnd7RV1GoNu2GBAZYJTae%2FzyyLubZ5ltMIOq074GOqUB0EIUVvlOVwUd20ctR204X0Zv7g6nLuwtZjrVu1anqiJ9mRUp0DKOlZCvNFH0EZItdA19g20EdVCafyEBvYxh16QadYGMci0htsAbXwxDXmm%2B%2BppVpPBQTlR7HORtxNBXH2R2GvpFhIqxUPCqieJcTjmMqpiHYRgk9aIXGT7nO99SK%2F7Rz%2BpruSVNtCQ2ExrdUN4tqjYZG7KVujsgP56ZSSpAVdXi\u0026X-Amz-Signature=58e508572ccd0f09b870242e05c6e3afaeec3fb82fbb02cc413084f6a211476e\u0026X-Amz-SignedHeaders=host\u0026x-id=GetObject)","children":[]}]},{"blockId":"1ada501e-f337-8102-af67-dbdd1901ffdc","type":"heading_3","parent":"###  実行される流れ","children":[]},{"blockId":"1ada501e-f337-81dc-82b0-e1648adba62e","type":"numbered_list_item","parent":"1. 最初に `create_migrations_table()` を実行して `migrations` テーブルを作成します。（既に作成済みの場合は何も処理しません）","children":[]},{"blockId":"1ada501e-f337-8188-b233-f340271f5b6c","type":"numbered_list_item","parent":"2. 次に、まだ適用されていないマイグレーションが順番に実行されます。","children":[]},{"blockId":"1ada501e-f337-81d7-979d-eaa4a0d855f7","type":"numbered_list_item","parent":"3. 最後に、`migrations` テーブルにその履歴が保存されます。","children":[]},{"blockId":"1ada501e-f337-81d6-87ff-ef374f7dd536","type":"paragraph","parent":"これで、マイグレーションできる仕組みが完成しました。","children":[]},{"blockId":"1ada501e-f337-8183-a812-d251d5a95789","type":"paragraph","parent":"これを使えば、スキーマを変更するマイグレーションファイルを追加して`apply_migrations.py`を実行すると、いつでもデータベースのスキーマを変更できます。","children":[]},{"blockId":"1ada501e-f337-8179-864a-f209461e1602","type":"paragraph","parent":"","children":[]}],"pageNavs":[{"title":"Home","id":"/posts"},{"title":"基礎班カリキュラム","id":"/posts/course/basic"},{"title":"後期","id":"/posts/course/後期"},{"title":"データベース基礎","id":"/posts/curriculums/1ada501e-f337-81e8-b251-df0f38a0cb23/1ada501e-f337-81e8-b251-df0f38a0cb23"},{"id":"/posts/curriculums/1ada501e-f337-81e8-b251-df0f38a0cb23/1ada501e-f337-81ac-a7f5-efdaf65ef9e7","title":"マイグレーション"}],"childrenData":{"title":"データベース基礎","childPages":[{"title":"データベースとは","id":"1ada501e-f337-81ce-889f-d99449a4ba30"},{"title":"Pythonでデータベースを扱うためのライブラリ","id":"1ada501e-f337-81ea-92d1-dcb4d8f60e2a"},{"title":"データベースとの接続とテーブルの作成","id":"1ada501e-f337-8160-b03e-f28f8a18fa43"},{"title":"データの保存(Create)","id":"1ada501e-f337-8124-834c-d232ae4e3855"},{"title":"データの取得(Read)","id":"1ada501e-f337-81fe-9043-da67e48709a8"},{"title":"データの編集(Update)","id":"1ada501e-f337-815a-a9e6-d8cdd63afa9c"},{"title":"データの削除(Delete)","id":"1ada501e-f337-8190-b5d5-ff083def3250"},{"title":"テーブルの編集","id":"1ada501e-f337-81a2-bb7a-d5bc48cd5f09"},{"title":"CRUD操作を使い回せるようにしよう","id":"1ada501e-f337-81d2-8f41-cd45c5a72b38"},{"title":"マイグレーション","id":"1ada501e-f337-81ac-a7f5-efdaf65ef9e7"},{"title":"カラムの属性","id":"1ada501e-f337-81bc-8a50-df2e526e6153"},{"title":"SQL文","id":"1ada501e-f337-8175-826a-d32ae9e3e34d"}]},"pageId":"1ada501e-f337-81ac-a7f5-efdaf65ef9e7","title":"マイグレーション"},"__N_SSG":true},"page":"/posts/curriculums/[curriculumId]/[pageId]","query":{"curriculumId":"1ada501e-f337-81e8-b251-df0f38a0cb23","pageId":"1ada501e-f337-81ac-a7f5-efdaf65ef9e7"},"buildId":"ALgaCejQZrABwXgBmpKFY","assetPrefix":"/horizon-atlas","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>